<div crm-ui-debug="selectedCases"></div>
<div class="mailutils__thread-list" ng-class="{'mailutils__thread-list--summary': viewingThread}">
  <mailutils-bulk-actions-message
    selected-items="selectedThreads.length" total-count="totalCount"
    is-select-all-available="isSelectAllAvailable" show-checkboxes="showCheckboxes"
    ng-hide="viewingThread">
  </mailutils-bulk-actions-message>
  <div ng-show="viewingThread"
    class="mailutils__thread-list-column--first--detached"
    ng-include="'~/mailutils/thread/directives/thread-list-table-first-column-header.html'">
  </div>
  <div
    class="panel panel-default mailutils__thread-list-panel"
    ng-class="{'mailutils__thread-list-panel--summary': viewingThread, 'mailutils__thread-list-panel--focused': threadIsFocused}">
    <div class="mailutils__thread-list-table-container" mailutils-sticky-table-header>
      <table ng-show="!threadIsFocused" class="table mailutils__thread-list-table" >
        <thead class="mailutils__thread-list-table__header">
        <tr>
          <th
            ng-show="!viewingThread"
            class="mailutils__thread-list-column--fixed mailutils__thread-list-column--first"
            ng-include="'~/mailutils/thread/directives/thread-list-table-first-column-header.html'">
          </th>
          <th
                  ng-show="!viewingThread"
                  ng-repeat="header in headers"
                  mailutils-thread-list-sort-header="{{ header.sort }}">{{ ts(header.label) }}
          </th>
        </tr>
        </thead>
        <tbody>
        <tr ng-if="!isLoading" ng-repeat="item in threads" >
          <td ng-click="viewThread(item.id, $event)">
            <mailutils-thread-card mode="thread-list" thread="item"></mailutils-thread-card>
          </td>
          <td
            ng-show="!viewingThread"
            ng-repeat="header in headers"
            ng-class="{'case-activity-card-wrapper': header.display_type == 'activity_card'}">

            <span ng-switch on="header.display_type">
              <span ng-switch-when="activity_card">
                <div
                  ng-if="!item.lock"
                  case-activity-card="item[header.name]"
                  refresh-callback="refresh"
                  case="item"
                  crm-popup-form-success="refresh()"
                >
                </div>
              </span>
              <span ng-switch-when="status_badge" class="crm_notification-badge" style="background-color: {{ item.color }};">
                {{ item.status }}
              </span>
              <span ng-switch-when="contact_reference">{{ item[header.name].display_name }}</span>
              <span ng-switch-when="date">{{ CRM.utils.formatDate(item[header.name]) }}</span>
              <span ng-switch-when="multiple_values">{{ item[header.name].join(', ') }}</span>
              <span ng-switch-default>{{ item[header.name] }}</span>
            </span>
          </td>
        </tr>
        <!-- Loading state HTML -->
        <tr class="mailutils__case-placeholder-row" ng-repeat="placeholder in casePlaceholders" ng-if="isLoading">
          <td>
            <div class="mailutils__case-card panel-default panel-strip-primary mailutils__loading-placeholder__oneline-strip">
              <div class="panel-body">
                <h2 style="width: 60%; margin-top: 10px;" class="mailutils__loading-placeholder__oneline"></h2>
                <div style="width: 80%; margin-top: 10px;" class="mailutils__loading-placeholder__oneline"></div>
                <div style="width: 60%; margin-top: 10px;" class="mailutils__loading-placeholder__oneline"></div>
                <div style="width: 80%; margin-top: 10px;" class="mailutils__loading-placeholder__oneline"></div>
                <div style="width: 50%; margin-top: 10px;" class="mailutils__loading-placeholder__oneline"></div>
              </div>
            </div>
          </td>
          <td ng-show="!viewingCase"><div class="mailutils__loading-placeholder__activity-card"><div></div></div></td>
          <td ng-show="!viewingCase" ng-repeat="i in [1,2,3,4,5,6,7]"><div class="mailutils__loading-placeholder__oneline"></div></td>
        </tr>
        <!-- Empty State HTML -->
        <tr ng-if="!cases.length && !isLoading" class="mailutils__panel-empty">
          <td></td>
          <td colspan="{{ headers.length }}">
            <i class="fa fa-folder-o fa-big"></i>
            <div class="empty-label">{{ ts('No cases found matching the search criteria.') }}</div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div
    class="center-block mailutils__pager" mailutils-sticky-footer-pager
    ng-class="{
      'mailutils__pager--viewing-case': viewingCase,
      'mailutils__pager--case-focused': caseIsFocused
    }">
    <paging
      ng-show="!caseIsFocused && page.total > 1"
      page="page.num"
      page-size="page.size"
      total="totalCount"
      adjacent="1"
      dots="..."
      show-prev-next="true"
      show-first-last="true"
      text-first="&laquo;"
      text-last="&raquo;"
      text-next="&rsaquo;"
      text-prev="&lsaquo;"
    ></paging>
  </div>
  <div
    class="panel panel-default mailutils__case-details-panel"
    ng-class="{'mailutils__case-details-panel--focused': caseIsFocused, 'mailutils__case-details-panel--summary': viewingCase}"
    mailutils-case-details="viewingCaseDetails"
    mailutils-tab="viewingCaseTab"
    mailutils-focused="caseIsFocused">
  </div>
</div>
